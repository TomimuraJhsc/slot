<link rel="stylesheet" href="/stylesheets/hall_map.css">

<div style="padding: 20px; max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 30px;">
        <%= link_to "â† ãƒãƒƒãƒ—ä¸€è¦§ã«æˆ»ã‚‹", hall_maps_path(@hall), class: "btn-secondary" %>
    </div>

    <div class="form-container">
        <h1>ğŸ—ºï¸ æ–°è¦ãƒãƒƒãƒ—ä½œæˆ</h1>
        <p style="color: #666; margin-bottom: 30px;">
            åº—å†…ã®é…ç½®å›³ã‚’ä½œæˆã—ã¾ã™ã€‚ã¾ãšã¯ãƒãƒƒãƒ—ã®åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
        </p>

        <%= form_with model: @map, url: hall_maps_path(@hall), local: true do |f| %>
        <div class="form-group">
            <%= f.label :name, "ãƒãƒƒãƒ—å", class: "form-label" %>
            <%= f.text_field :name, class: "form-control", placeholder: "ä¾‹: 1éšãƒ•ãƒ­ã‚¢ã€2éšãƒ•ãƒ­ã‚¢", required: true %>
            <small class="form-text">ã‚ã‹ã‚Šã‚„ã™ã„åå‰ã‚’ä»˜ã‘ã¦ãã ã•ã„</small>
        </div>

        <div class="form-row">
            <div class="form-group">
                <%= f.label :rows, "è¡Œæ•°ï¼ˆç¸¦ï¼‰", class: "form-label" %>
                <%= f.number_field :rows, class: "form-control", min: 1, max: 100, value: @map.rows || 20, required: true %>
                <small class="form-text">1ã€œ100</small>
            </div>

            <div class="form-group">
                <%= f.label :cols, "åˆ—æ•°ï¼ˆæ¨ªï¼‰", class: "form-label" %>
                <%= f.number_field :cols, class: "form-control", min: 1, max: 100, value: @map.cols || 40, required: true %>
                <small class="form-text">1ã€œ100</small>
            </div>
        </div>

        <div class="form-preview">
            <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
            <div id="grid-preview" style="overflow: auto; max-height: 400px;">
                <!-- JavaScript ã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            <p style="text-align: center; color: #666; margin-top: 10px; font-size: 13px;">
                â€»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æœ€å¤§20è¡ŒÃ—40åˆ—ã¾ã§è¡¨ç¤ºã•ã‚Œã¾ã™
            </p>
        </div>

        <div class="form-actions">
            <%= link_to "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", hall_maps_path(@hall), class: "btn-secondary" %>
            <%= f.submit "ä½œæˆã—ã¦ç·¨é›†ç”»é¢ã¸", class: "btn-primary" %>
        </div>
        <% end %>
    </div>
</div>

<script>
    function updatePreview() {
        const rows = parseInt(document.querySelector('[name="hall_map[rows]"]').value) || 20;
        const cols = parseInt(document.querySelector('[name="hall_map[cols]"]').value) || 40;
        const preview = document.getElementById('grid-preview');

        const previewRows = Math.min(rows, 20);
        const previewCols = Math.min(cols, 40);

        let html = '<table class="preview-table">';
        for (let r = 1; r <= previewRows; r++) {
            html += '<tr>';
            for (let c = 1; c <= previewCols; c++) {
                html += '<td></td>';
            }
            html += '</tr>';
        }
        html += '</table>';

        preview.innerHTML = html;
    }

    document.addEventListener('DOMContentLoaded', function() {
        updatePreview();

        document.querySelector('[name="hall_map[rows]"]').addEventListener('input', updatePreview);
        document.querySelector('[name="hall_map[cols]"]').addEventListener('input', updatePreview);
    });
</script>

<style>
    .form-container {
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-control:focus {
        outline: none;
        border-color: #0066cc;
        box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
    }

    .form-text {
        display: block;
        margin-top: 5px;
        color: #666;
        font-size: 13px;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .form-preview {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 4px;
        margin-bottom: 25px;
    }

    .form-preview h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
    }

    .preview-table {
        border-collapse: collapse;
        margin: 0 auto;
    }

    .preview-table td {
        width: 20px;
        height: 20px;
        border: 1px solid #ddd;
        background: #fff;
    }

    .form-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        padding-top: 20px;
        border-top: 1px solid #ddd;
    }

    .btn-primary,
    .btn-secondary {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background: #0066cc;
        color: white;
    }

    .btn-primary:hover {
        background: #0052a3;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
    }
</style>